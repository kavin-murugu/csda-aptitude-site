<!DOCTYPE html>
<html>
<head>
  <title>CSDA Aptitude Login</title>
</head>
<body>
  <h2>Login with Google</h2>
  <button onclick="login()">Login</button>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ✅ Your Firebase config here:
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MSG_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ✅ Login function
    window.login = async function () {
      const provider = new GoogleAuthProvider();
      try {
        const result = await signInWithPopup(auth, provider);
        const email = result.user.email;

        const q = query(collection(db, "users"), where("email", "==", email));
        const snapshot = await getDocs(q);

        if (!snapshot.empty) {
          const userData = snapshot.docs[0].data();
          if (userData.role === "admin") {
            window.location.href = "admin.html";
          } else {
            window.location.href = "student.html";
          }
        } else {
          alert("You are not authorized. Ask admin.");
        }

      } catch (error) {
        console.error("Login error:", error);
        alert("Login failed.");
      }
    }
  </script>
</body>
</html>
